# Разработческий план Wallet Health Checker (MVP)

## Архитектура системы
```
┌───────────────────────────────────────────────────────────────────┐
│                     HTTP API (Port 8080)                         │
│  • GET /health - Проверка статуса сервиса                        │
│  • POST /api/check - Анализ безопасности кошелька               │
└──────────────────────────────────┬────────────────────────────────┘
                                   │
┌──────────────────────────────────▼────────────────────────────────┐
│                     Aggregator Service                           │
│  • оркестрация проверок                                         │
│  • параллельный запуск через errgroup                            │
│  • расчет финального балла                                       │
└──────────────────────────────────┬────────────────────────────────┘
                                   │
┌──────────────────────────────────▼────────────────────────────────┐
│                     Checker Factory                              │
│  • создание экземпляров проверок по типу                         │
│  • абстракция от конкретных реализаций                           │
└──────────────────────────────────┬────────────────────────────────┘
                                   │
┌──────────────────────────────────▼────────────────────────────────┐
│                     Health Checks                                │
│  • ApprovalsCheck - Проверка разрешений токенов                  │
│  • RugPullCheck - Проверка на rug pull контакты                  │
│  • AssetCompositionCheck - Анализ состава активов                │
│  • ScamTokensCheck - Проверка на скам-токены                     │
│  • DeadNFTCheck - Проверка на мертвые NFT                        │
└──────────────────────────────────┬────────────────────────────────┘
                                   │
┌──────────────────────────────────▼────────────────────────────────┐
│                     API Providers                                │
│  • GoPlus Client - доступ к GoPlus Security API                   │
│  • Etherscan Client - доступ к Etherscan API                      │
└──────────────────────────────────┬────────────────────────────────┘
                                   │
┌──────────────────────────────────▼────────────────────────────────┐
│                     Configuration & Logging                      │
│  • config.yaml - основные настройки                              │
│  • .env - секреты (API keys)                                     │
│  • logrus - структурированное логирование                        │
└───────────────────────────────────────────────────────────────────┘
```

## Детализация этапов разработки

### 1. Загрузчик конфигурации (config/loader.go)
- Чтение config.yaml
- Поддержка переменных окружения из .env
- Структура Config для удобного доступа к настройкам
- Валидация обязательных полей

### 2. Логирование (pkg/logger/logger.go)
- Настройка logrus
- Поддержка различных уровней логирования (debug, info, error)
- Структурированное логирование в JSON формате
- Логирование запросов и ответов API

### 3. Общие структуры данных (internal/entity/)
- WalletReport - финальный отчет о безопасности кошелька
- CheckResult - результат одной проверки
- TokenInfo - информация о токене
- ApprovalInfo - информация о разрешении на токен
- RiskLevel - уровень риска (LOW, MEDIUM, HIGH, CRITICAL)

### 4. Клиенты для внешних API (internal/provider/)
- GoPlusClient - обертка для GoPlus Security API
  - Токен approval security
  - Токен security
  - Rug-pull detection
  - NFT security
- EtherscanClient - обертка для Etherscan API
  - Балансы токенов
  - История транзакций
- Обработка ошибок и rate limiting

### 5. Интерфейс и фабрика проверок
- IHealthCheck - контракт для всех проверок
- CheckType - константы для типов проверок
- NewChecker - фабричная функция для создания проверок

### 6. Реализация проверок (internal/checker/internal/checks/)
- ApprovalsCheck (приоритет 1) - проверка разрешений на токены
- RugPullCheck (приоритет 2) - проверка на взаимодействие с rug pull контрактами
- AssetCompositionCheck (приоритет 3) - анализ состава активов
- ScamTokensCheck (приоритет 4) - проверка на скам-токены
- DeadNFTCheck (приоритет 5) - проверка на мертвые NFT

### 7. Агрегатор результатов (internal/aggregator/service.go)
- ExecuteChecks - запуск всех проверок в параллели
- CalculateScore - расчет финального балла безопасности
- GenerateReport - формирование JSON отчета

### 8. HTTP сервер (cmd/app/main.go)
- Настройка роутера (Chi или Gin)
- Обработчики для /health и /api/check
- Валидация входящих запросов
- Ответы с правильными кодами состояния

### 9. Тестирование
- Unit тесты для проверок
- Интеграционные тесты для API клиентов
- Тесты на сценарии с ошибками API

### 10. Dockerfile
- Multistage build для минимального образа
- Настройка окружения
- Экспорт порта 8080

## Инструкции по запуску
1. Копировать .env.example в .env и заполнить API keys
2. Запустить `go run cmd/app/main.go`
3. Обращаться к http://localhost:8080/api/check с адресом кошелька

## Метрики и логирование
- Логи записываются в stdout в JSON формате
- Поддержка уровней логирования через config.yaml
- Метрики доступны через /metrics endpoint (при добавлении Prometheus)
